<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="web.dao.face.BoardDao">	
 	<select id="selectList" resultType="web.dto.Board" parameterType="web.util.Paging">
		SELECT * FROM (
			SELECT rownum rnum, B.* FROM (
				SELECT * FROM board
				LEFT OUTER JOIN users
				ON board.user_no = users.user_no
				ORDER BY board_no DESC
				) B
			) BOARD
		WHERE rnum BETWEEN #{startNo} AND #{endNo}
  	</select>

  	<select id="selectCntAll" resultType="int">
  		SELECT count(*) FROM board
  	</select>
  	
  	<update id="hit" parameterType="web.dto.Board">
  		UPDATE board
  		SET board_hit = board_hit + 1
  		WHERE board_no = #{boardNo}
  	</update>
  	
  	<select id="select" resultType="web.dto.Board" parameterType="web.dto.Board">
  		SELECT * FROM board
		LEFT JOIN USERS
		ON BOARD.user_no = USERS.user_no
  		WHERE board_no = #{boardNo}
  	</select>
  	
  	<insert id="insertBoard" parameterType="web.dto.Board">
  		<selectKey order="BEFORE" resultType="int" keyProperty="boardNo">
  			SELECT board_seq.nextval FROM dual
  		</selectKey>
  		
  		INSERT INTO board ( board_no, board_title, board_content, board_hit, user_no )
  		VALUES ( #{boardNo}, #{boardTitle}, #{boardContent}, 0, 1 )
  	</insert>
  	
  	<insert id="insertFile" parameterType="web.dto.Files">
  		INSERT INTO Files ( file_no, originname, storedname, filesize, file_date, categoryType, board_no )
  		VALUES ( files_seq.nextval, #{originname}, #{storedname}, #{filesize}, #{category_type}, #{file_date}, #{boardNo} )
  	</insert>
  	
  	<select id="selectBoardFileByBoardNo" resultType="web.dto.Files" parameterType="web.dto.Board">
  		SELECT
  			file_no, originname, storedname, board_no
  		FROM Files
  		WHERE board_no = #{boardNo}
  	</select>
  	
  	<update id="update" parameterType="web.dto.Board">
  		UPDATE board
  		SET 		
  			board_title = #{boardTitle}
  			, board_content = #{boardContent}
  		WHERE board_no = #{boardNo}
  	</update>

  	<delete id="delete" parameterType="web.dto.Board">
  		DELETE board
  		WHERE board_no = #{boardNo}
  	</delete>
 
  </mapper>